<!doctype html>

<html>

    <head>
        <meta charset="utf-8">
        <meta name="author" content="MyGeekLab">
        <meta name="keywords" content="">
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <title>Comnt</title>

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://opensource.keycdn.com/fontawesome/4.7.0/font-awesome.min.css" integrity="sha384-dNpIIXE8U05kAbPhy3G1cz+yZmTzA6CY8Vg/u2L9xRnHjJiAK76m2BIEaSEV+/aU" crossorigin="anonymous">
        <script src="https://www.gstatic.com/firebasejs/3.6.1/firebase-database.js"></script>
        <script src="https://www.gstatic.com/firebasejs/3.6.2/firebase.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <link rel="stylesheet" href="style.css">
        <script src="script.js"></script>
    </head>

<body>
    
  <div class="container">

        <div class="comment-box">
            <div class="comment-form">
                <div class="header">Add Your Comment</div>
                <form action="#" onsubmit="event.preventDefault(); postComment()">
                    <div> 
                        <input type="text" id="name" placeholder="Name"/>
                    </div>
                    <div>
                        <textarea id="comment" rows="3" cols="30" placeholder="Comment"></textarea>
                    </div>
                    <button type="submit">COMMENT</button>
                </form>  
            </div>
            <div>
                <h4 class="header">Comments</h4>
                <div id="comments"></div>
            </div>
            <div class="footer"><hr><p>&copy 2016 by Josh Bivens</p></div>
        </div>
  </div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script src="https://www.gstatic.com/firebasejs/3.6.2/firebase.js"></script>
        <script src="https://www.gstatic.com/firebasejs/3.6.1/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/3.6.1/firebase-database.js"></script>
        <script type="text/javascript">
            // Initialize Firebase
            var config = {
                apiKey: "AIzaSyATk9INr4Tp9MKWOgwDpibQY0ZxU6oTXqU",
                authDomain: "comnt-6fba7.firebaseapp.com",
                databaseURL: "https://comnt-6fba7.firebaseio.com",
                storageBucket: "comnt-6fba7.appspot.com",
                messagingSenderId: "383516540753"
            };
            firebase.initializeApp(config);

            var ref = new Firebase("https://comnt-6fba7.firebaseio.com/");
            var database = firebase.database();

            // Thanks to https://gist.github.com/hurjas/2660489#file-timestamp-js-L26
            function timeStamp() {
            var now = new Date();
            var date = [now.getMonth() + 1, now.getDate(), now.getFullYear()];
            var time = [now.getHours(), now.getMinutes()];
            var suffix = (time[0] < 12) ? "AM" : "PM";
            time[0] = (time[0] < 12) ? time[0] : time[0] - 12;

            for (var i = 1; i < 3; i++) {
                if (time[i] < 10) {
                time[i] = "0" + time[i];
                }
            }

            return date.join("/") + ", " + time.join(":") + " " + suffix;
            }

            function postComment() {
                firebase.database().ref.set({
                    name: document.getElementById("name").value;
                    comment: document.getElementById("comment").value;
                    time: timeStamp();
                })
                /*
            var name = document.getElementById("name").value,
                comment = document.getElementById("comment").value,
                time = timeStamp();
                */

            if (name && comment) {
                ref.push({
                name: name,
                comment: comment,
                time: time
                });
            }

            document.getElementById("name").value = '';
            document.getElementById("comment").value = '';
            }

            ref.on("child_added", function(snapshot) {
            var comment = snapshot.val();
            addComment(comment.name, comment.comment, comment.time);
            });

            function addComment(name, comment, timeStamp) {
            var comments = document.getElementById("comments");
            comments.innerHTML = "<hr><h4>" + name + " says<span>" + timeStamp + "</span></h4><p>" + comment + "</p>" + comments.innerHTML;
            }

        </script>


</body>

</html>